<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Personal Assistant</title>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body data-theme="dark">
    <!-- Main container for new responsive layout -->
    <div id="main-container">
        <!-- Gadgets will become a sidebar on wide screens -->
        <div id="gadget-container">
            <div class="gadget" id="gadget-clock">
                <button class="dismiss-gadget" aria-label="Dismiss Gadget">&times;</button>
                <h3>Real-time Clock</h3>
                <time id="clock-time">00:00:00</time>
            </div>
            <div class="gadget" id="gadget-tasks">
                 <button class="dismiss-gadget" aria-label="Dismiss Gadget">&times;</button>
                <h3>Project Alpha</h3>
                <p>Task Progress</p>
                <div class="progress-bar">
                    <div class="progress" style="width: 75%;"></div>
                </div>
                <span>75% Complete</span>
            </div>
        </div>

        <!-- Main content area for single or split view -->
        <div id="main-content">
            <div id="pane-primary" class="pane"></div>
            <div id="pane-secondary" class="pane"></div>
        </div>
        
        <!-- Original wallet container for mobile/portrait view -->
        <div id="wallet-container">
            <!-- Cards are now templates for cloning -->
        </div>

        <!-- Quick Switch UI for swipe gestures -->
        <div id="quick-switch-overlay"></div>
        <div id="quick-switch-container"></div>

        <!-- Confirmation Toast (iOS style) -->
        <div id="confirmation-toast">
            <div id="toast-content">
                <div id="toast-customer-message">
                    <span class="toast-label">Cliente</span>
                    <p></p>
                </div>
                <div id="toast-ai-reply">
                    <span class="toast-label">Respuesta IA</span>
                    <p></p>
                </div>
            </div>
            <div id="toast-actions">
                <button id="toast-cancel-btn">Cancelar</button>
                <button id="toast-send-btn">Enviar</button>
            </div>
        </div>

    </div>
    
    <!-- Templates for cards -->
    <div id="card-templates" style="display: none;">
        <template id="template-card-home">
             <div class="card" id="card-home">
                <div class="card-content" id="home-content">
                     <div id="quick-access-container">
                        <form id="quick-access-form">
                            <input type="text" id="quick-access-input" placeholder="Quick question for Gemini..." autocomplete="off" required>
                            <button type="submit" aria-label="Send to Gemini">
                               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <rect x="9" y="2" width="6" height="11" rx="3"></rect>
                                    <path d="M5 10v2a7 7 0 0 0 14 0v-2"></path>
                                    <line x1="12" y1="19" x2="12" y2="22"></line>
                                </svg>
                            </button>
                        </form>
                        <div id="quick-access-response">
                             <p id="quick-access-text"></p>
                             <button id="go-to-chat-btn">Go to Chat</button>
                        </div>
                    </div>
                    <div class="shortcut-grid">
                        <!-- Shortcut buttons will be initialized by JS -->
                    </div>
                </div>
            </div>
        </template>
        <template id="template-card-chat">
             <div class="card" id="card-chat" data-icon-id="assistant-icon">
                <header class="card-header">
                    <div class="chat-settings-container">
                        <button id="chat-settings-btn" class="chat-header-btn" aria-label="Chat Settings">
                            <!-- Gear icon added by JS -->
                        </button>
                        <!-- Old menu is removed, logic now opens a modal -->
                    </div>
                    <h2>Live Assistant</h2>
                    <div class="card-controls">
                        <!-- Controls will be added by JS -->
                    </div>
                </header>
                <div class="card-content">
                    <main id="chat-log">
                        <!-- Chat history will be loaded here by JS -->
                    </main>
                    <footer>
                         <div id="chat-suggestions-container">
                            <!-- Intelligent suggestions will be rendered here by JS -->
                        </div>
                        <form id="chat-form" aria-label="Chat input form">
                            <button type="button" id="mic-btn" aria-label="Use microphone">
                               <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                  <path d="M12 2.25c-2.42 0-4.385 1.965-4.385 4.385v5.25a4.385 4.385 0 008.77 0v-5.25A4.385 4.385 0 0012 2.25zM10.115 18.293a.75.75 0 000 1.06l.44.44a.75.75 0 001.06 0l.44-.44a.75.75 0 000-1.06l-1.5-1.5a.75.75 0 00-1.06 0l-1.5 1.5zM12 17.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V18a.75.75 0 01.75-.75zM14.943 18.293a.75.75 0 001.06 0l1.5-1.5a.75.75 0 00-1.06-1.06l-.44.44a.75.75 0 000 1.06l.44.44z"></path>
                                  <path fill-rule="evenodd" d="M16.5 11.635v-5.25a4.5 4.5 0 00-9 0v5.25a6 6 0 00-1.5 11.264.75.75 0 001.5 0 4.5 4.5 0 018.998 0 .75.75 0 001.5 0A6 6 0 0016.5 11.635zM12 21a3 3 0 01-3-3V13.5a3 3 0 116 0v4.5a3 3 0 01-3 3z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <textarea id="chat-input" placeholder="Ask me anything..." aria-label="Message input" rows="1"></textarea>
                            <button type="submit" id="send-btn" aria-label="Send message" disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                                   <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                                </svg>
                            </button>
                            <button type="button" id="stop-btn" aria-label="Stop generating response">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                    <path fill-rule="evenodd" d="M4.5 7.5a3 3 0 013-3h9a3 3 0 013 3v9a3 3 0 01-3-3h-9a3 3 0 01-3-3v-9z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </form>
                    </footer>
                </div>
            </div>
        </template>
        <template id="template-card-inbox">
            <div class="card" id="card-inbox" data-icon-id="inbox-icon">
                <header class="card-header">
                    <h2>Inbox</h2>
                    <div class="card-controls"></div>
                </header>
                <div class="card-content" id="inbox-content">
                    <div id="inbox-paste-area">
                        <textarea id="inbox-paste-input" placeholder="Paste customer conversation here..."></textarea>
                        <button id="inbox-process-btn">Process Message</button>
                    </div>
                    <div id="inbox-message-list-container">
                        <h3>Pending Replies</h3>
                        <ul id="inbox-message-list">
                           <!-- JS will populate this -->
                           <li class="no-messages">Paste a conversation to get started.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </template>
         <template id="template-card-tasks">
            <div class="card" id="card-tasks" data-icon-id="tasks-icon">
                <header class="card-header">
                    <h2>Tasks</h2>
                    <div class="card-controls"></div>
                </header>
                <div class="card-content" id="tasks-content">
                    <ul class="task-list-container" id="task-list">
                        <!-- Tasks will be rendered here by JS -->
                    </ul>
                    <form class="task-add-form" id="add-task-form" aria-label="Add new task form">
                        <input type="text" id="task-title-input" placeholder="Add a new task..." required aria-label="Task title">
                        <select id="task-priority-select" aria-label="Task priority">
                            <option value="high">High</option>
                            <option value="medium" selected>Medium</option>
                            <option value="low">Low</option>
                        </select>
                        <button type="submit">Add</button>
                    </form>
                </div>
            </div>
        </template>
        <template id="template-card-settings">
            <div class="card" id="card-settings" data-icon-id="settings-icon">
                <header class="card-header">
                    <h2>Settings</h2>
                    <div class="card-controls"></div>
                </header>
                <div class="card-content" id="settings-content">
                    <div class="setting-group">
                        <label>Theme</label>
                        <div class="theme-switcher" id="theme-switcher">
                            <button class="theme-btn" data-theme="dark" aria-label="Switch to Dark Theme">Dark</button>
                            <button class="theme-btn" data-theme="light" aria-label="Switch to Light Theme">Light</button>
                        </div>
                    </div>
                    <hr class="setting-divider">
                    <div class="setting-group vertical">
                        <label>API Key Management</label>
                        <p class="setting-description">Manage keys for external services. Keys are stored securely in your browser's local storage.</p>
                        <ul id="api-keys-list">
                            <!-- API keys will be rendered here by JS -->
                        </ul>
                        <form class="api-key-form" id="add-api-key-form">
                            <input type="text" id="api-key-name-input" placeholder="Service Name (e.g., Facebook)" required>
                            <input type="password" id="api-key-value-input" placeholder="API Key Value" required>
                            <button type="submit">Add Key</button>
                        </form>
                    </div>
                </div>
            </div>
        </template>
        <template id="template-card-notes">
            <div class="card" id="card-notes" data-icon-id="notes-icon">
                <header class="card-header">
                    <h2>Notes</h2>
                    <div class="card-controls"></div>
                </header>
                <div class="card-content" id="notes-content">
                    <ul class="notes-list-container" id="notes-list">
                        <!-- Notes rendered by JS -->
                    </ul>
                    <form class="note-add-form" id="add-note-form">
                        <textarea id="note-content-input" placeholder="Jot something down..." required></textarea>
                        <button type="submit">Save Note</button>
                    </form>
                </div>
            </div>
        </template>
        <template id="template-card-gadgets">
            <div class="card" id="card-gadgets" data-icon-id="gadgets-icon">
                <header class="card-header">
                    <h2>Gadgets</h2>
                    <div class="card-controls"></div>
                </header>
                <div class="card-content" id="gadgets-content">
                    <!-- Widgets will be dynamically rendered here -->
                     <div class="card-placeholder-content">
                        <p>Loading gadgets... if this takes too long, the backend might be napping.</p>
                    </div>
                </div>
            </div>
        </template>
    </div>

     <!-- Chat Settings Modal -->
    <div id="chat-settings-modal-overlay"></div>
    <div id="chat-settings-modal">
        <header>
            <h2>Chat Settings</h2>
            <button id="chat-settings-modal-close-btn">&times;</button>
        </header>
        <main>
            <section id="format-templates-section">
                <h3>Format Templates</h3>
                <div id="format-templates-list">
                    <!-- JS will populate this -->
                </div>
                <form id="add-template-form">
                    <input type="text" id="new-template-name" placeholder="Template Name" required>
                    <textarea id="new-template-content" placeholder="Template Content/Instructions..." required></textarea>
                    <button type="submit">Add Template</button>
                </form>
            </section>
            <hr>
            <section>
                <h3>Persistent Context</h3>
                <textarea id="persistent-context-input" placeholder="Provide general context for all conversations..."></textarea>
            </section>
        </main>
        <footer>
            <button class="chat-settings-item" id="download-debug-btn">Download Debug Log</button>
            <button class="chat-settings-item" id="clear-history-btn">New Chat</button>
        </footer>
    </div>


    <!-- App Switcher UI -->
    <div id="app-switcher-overlay"></div>
    <div id="app-switcher">
        <div id="switcher-drag-handle"></div>
        <div id="switcher-grid"></div>
    </div>
    <div id="swipe-up-handle"></div>

    <!-- Icon definitions for JS cloning -->
    <div style="display: none;">
        <svg id="cards-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
           <rect x="4" y="4" width="6" height="6" rx="1"></rect>
           <rect x="14" y="4" width="6" height="6" rx="1"></rect>
           <rect x="4" y="14" width="6" height="6" rx="1"></rect>
           <rect x="14" y="14" width="6" height="6" rx="1"></rect>
        </svg>
        <svg id="assistant-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
            <path d="M12 1a3 3 0 0 1 3 3v8a3 3 0 0 1 -6 0v-8a3 3 0 0 1 3 -3z"></path>
            <path d="M19 10v2a7 7 0 0 1 -14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="22"></line>
        </svg>
        <svg id="inbox-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <path d="m4 13h3l3 3h4l3 -3h3" />
        </svg>
        <svg id="tasks-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
           <path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"></path>
           <rect x="9" y="3" width="6" height="4" rx="2"></rect>
           <path d="M9 12l2 2l4 -4"></path>
        </svg>
        <svg id="notes-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
           <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
           <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"></path>
           <line x1="9" y1="9" x2="10" y2="9"></line>
           <line x1="9" y1="13" x2="15" y2="13"></line>
           <line x1="9" y1="17" x2="15" y2="17"></line>
        </svg>
        <svg id="gadgets-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
           <path d="M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
           <path d="M4 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
           <path d="M6 6h4"></path>
           <path d="M16 6h4"></path>
           <path d="M14 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
           <path d="M4 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"></path>
           <path d="M6 18h4"></path>
           <path d="M16 18h4"></path>
        </svg>
         <svg id="settings-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
           <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
           <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 -1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"></path>
           <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <svg id="settings-gear-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296 .07 2.572-1.065z"></path>
            <circle cx="12" cy="12" r="3"></circle>
        </svg>
    </div>

    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.12.0",
    "express": "https://aistudiocdn.com/express@^5.1.0",
    "cors": "https://aistudiocdn.com/cors@^2.8.5",
    "dotenv": "https://aistudiocdn.com/dotenv@^17.2.2"
  }
}
</script>
    <script type="module" src="index.js"></script>
</body>
</html>